<div class="detail-container" *ngIf="lake">
  <!-- Back Button -->
  <div class="back-button-container">
    <a routerLink="/" class="back-button">
      <span class="arrow">â†</span> ZurÃ¼ck zur Karte
    </a>
  </div>

  <!-- Bild-Gallery -->
  <div class="image-gallery">
    <!-- Bilder vorhanden -->
    <div class="gallery-container" 
         *ngIf="lake.images && lake.images.length > 0"
         (touchstart)="onTouchStart($event)" 
         (touchend)="onTouchEnd($event)">
      <img [src]="lake.images[currentImageIndex]" 
           [alt]="lake.name" 
           class="gallery-image">
      
      <!-- Navigation Arrows -->
      <button class="gallery-nav prev" 
              (click)="previousImage()" 
              [disabled]="currentImageIndex === 0"
              aria-label="Vorheriges Bild">
        â€¹
      </button>
      <button class="gallery-nav next" 
              (click)="nextImage()" 
              [disabled]="currentImageIndex >= lake.images.length - 1"
              aria-label="NÃ¤chstes Bild">
        â€º
      </button>
      
      <!-- Image Counter -->
      <div class="image-counter">
        {{ currentImageIndex + 1 }} / {{ lake.images.length }}
      </div>
    </div>
    
    <!-- Placeholder wenn keine Bilder -->
    <div class="gallery-placeholder" *ngIf="!lake.images || lake.images.length === 0">
      <div class="placeholder-content">
        <span class="placeholder-icon">ğŸ“·</span>
        <p class="placeholder-text">Noch keine Bilder vorhanden</p>
        <p class="placeholder-hint">Bilder kÃ¶nnen in lakes.json hinzugefÃ¼gt werden</p>
      </div>
    </div>
    
    <!-- Thumbnail Dots -->
    <div class="thumbnail-dots" *ngIf="lake.images && lake.images.length > 0">
      <button *ngFor="let img of lake.images; let i = index" 
              class="dot" 
              [class.active]="i === currentImageIndex"
              (click)="goToImage(i)"
              [attr.aria-label]="'Gehe zu Bild ' + (i + 1)">
      </button>
    </div>
  </div>

  <!-- See-Titel -->
  <div class="lake-header">
    <h1>{{ lake.name }}</h1>
    <p class="lake-subtitle">{{ lake.cantons }}</p>
    
    <!-- Fehler melden Button -->
    <button class="report-issue-btn" (click)="reportIssue.open()" title="Fehler melden">
      ğŸš¨ Fehler melden
    </button>
  </div>

  <!-- Content Grid -->
  <div class="content-grid">
    
    <!-- Wetter-Karte (NEU!) -->
    <div class="info-card weather-card" *ngIf="weather || isLoadingWeather">
      <h2>â˜€ï¸ Aktuelles Wetter</h2>
      
      <!-- Loading Spinner -->
      <div class="weather-loading" *ngIf="isLoadingWeather">
        <div class="spinner"></div>
        <p>Lade Wetterdaten...</p>
      </div>
      
      <!-- Wetter-Daten -->
      <div class="weather-content" *ngIf="!isLoadingWeather && weather">
        <div class="weather-main">
          <div class="weather-icon">
            <img [src]="'https://openweathermap.org/img/wn/' + weather.icon + '@2x.png'" 
                 [alt]="weather.description">
          </div>
          <div class="weather-temp">
            <div class="temp-big">{{ weather.temp }}Â°C</div>
            <div class="temp-feels">GefÃ¼hlt {{ weather.feelsLike }}Â°C</div>
            <div class="weather-desc">{{ weather.description }}</div>
          </div>
        </div>
        
        <div class="weather-details">
          <div class="weather-detail">
            <span class="icon">ğŸ’¨</span>
            <span class="label">Wind:</span>
            <span class="value">{{ weather.windSpeed }} km/h {{ getWindDirection(weather.windDeg) }}</span>
          </div>
          <div class="weather-detail">
            <span class="icon">ğŸ’§</span>
            <span class="label">Luftfeuchtigkeit:</span>
            <span class="value">{{ weather.humidity }}%</span>
          </div>
          <div class="weather-detail">
            <span class="icon">â˜ï¸</span>
            <span class="label">BewÃ¶lkung:</span>
            <span class="value">{{ weather.clouds }}%</span>
          </div>
          <div class="weather-detail">
            <span class="icon">{{ weather.moonPhaseEmoji }}</span>
            <span class="label">Mondphase:</span>
            <span class="value">{{ weather.moonPhase }}</span>
          </div>
        </div>
        
        <div class="weather-footer">
          <small>ğŸ• Daten werden alle 30 Min. aktualisiert</small>
        </div>
      </div>
    </div>
    
    <!-- Allgemeine Informationen -->
    <div class="info-card">
      <h2>ğŸ“Š Allgemeine Informationen</h2>
      <div class="info-list">
        <div class="info-item">
          <span class="label">FlÃ¤che:</span>
          <span class="value">{{ lake.area }}</span>
        </div>
        <div class="info-item">
          <span class="label">Maximale Tiefe:</span>
          <span class="value">{{ lake.maxDepth }}</span>
        </div>
        <div class="info-item">
          <span class="label">HÃ¶he Ã¼ber Meer:</span>
          <span class="value">{{ lake.elevation }}</span>
        </div>
        <div class="info-item">
          <span class="label">Beste Saison:</span>
          <span class="value">{{ lake.bestSeason }}</span>
        </div>
      </div>
    </div>

    <!-- Fischarten -->
    <div class="info-card">
      <h2>ğŸŸ Fischarten</h2>
      <div class="fish-tags">
        <span class="fish-tag" *ngFor="let fish of lake.fishSpecies">{{ fish }}</span>
      </div>
    </div>

    <!-- Patent-Preise -->
    <div class="info-card price-card" *ngIf="hasPrices">
      <h2>ğŸ’° Patent-Preise</h2>
      <div class="price-list">
        <div class="price-item" *ngIf="lake.permitPrices?.daily">
          <span class="price-label">Tagespatent</span>
          <span class="price-value">{{ lake.permitPrices?.daily }}</span>
        </div>
        <div class="price-item" *ngIf="lake.permitPrices?.weekly">
          <span class="price-label">Wochenpatent</span>
          <span class="price-value">{{ lake.permitPrices?.weekly }}</span>
        </div>
        <div class="price-item" *ngIf="lake.permitPrices?.monthly">
          <span class="price-label">Monatspatent</span>
          <span class="price-value">{{ lake.permitPrices?.monthly }}</span>
        </div>
        <div class="price-item" *ngIf="lake.permitPrices?.annual">
          <span class="price-label">Jahrespatent</span>
          <span class="price-value">{{ lake.permitPrices?.annual }}</span>
        </div>
        <div class="price-item" *ngIf="lake.permitPrices?.youth">
          <span class="price-label">Jugendpatent</span>
          <span class="price-value">{{ lake.permitPrices?.youth }}</span>
        </div>
      </div>
    </div>

    <!-- Bewilligung & Offizielle Webseite -->
    <div class="info-card">
      <h2>ğŸ“‹ Bewilligung</h2>
      
      <!-- Gratis Fischen Badge -->
      <div class="free-fishing-badge" *ngIf="lake.freeFishing">
        âœ“ Gratis Fischen mÃ¶glich - Kein Patent erforderlich
      </div>
      
      <!-- Permit Text -->
      <p class="permit-text" *ngIf="!lake.freeFishing">{{ lake.permitRequired }}</p>
      
      <!-- Offizielle Webseite Button - IMMER anzeigen -->
      <a [href]="lake.permitPrices?.link || 'https://www.sana.ch/'" 
         target="_blank" 
         rel="noopener noreferrer"
         class="official-website-btn">
        ğŸŒ Offizielle Webseite besuchen
      </a>
    </div>

    <!-- Regeln & Vorschriften -->
    <div class="info-card regulations-card" *ngIf="hasRegulations">
      <h2>âš–ï¸ Wichtige Regeln</h2>
      
      <div class="regulation-section" *ngIf="lake.regulations?.closedSeasons">
        <h3>Schonzeiten</h3>
        <p>{{ lake.regulations?.closedSeasons }}</p>
      </div>
      
      <div class="regulation-section" *ngIf="lake.regulations?.minSizes">
        <h3>MindestmaÃŸe</h3>
        <ul class="min-sizes-list">
          <li *ngFor="let fish of lake.regulations?.minSizes | keyvalue">
            <strong>{{ fish.key }}:</strong> {{ fish.value }}
          </li>
        </ul>
      </div>
      
      <div class="regulation-section" *ngIf="lake.regulations?.bagLimit">
        <h3>Fangbegrenzung</h3>
        <p>{{ lake.regulations?.bagLimit }}</p>
      </div>
      
      <div class="regulation-section" *ngIf="lake.regulations?.additionalRules">
        <h3>ZusÃ¤tzliche Regeln</h3>
        <ul class="additional-rules">
          <li *ngFor="let rule of lake.regulations?.additionalRules">{{ rule }}</li>
        </ul>
      </div>
    </div>

  </div>
</div>

<!-- Report Issue Modal -->
<app-report-issue 
  #reportIssue
  [lakeName]="lake?.name || ''"
  [lakeId]="lake?.id || ''">
</app-report-issue>

<!-- Fallback wenn kein See gefunden -->
<div class="not-found" *ngIf="!lake">
  <h1>See nicht gefunden</h1>
  <a routerLink="/" class="back-button">ZurÃ¼ck zur Karte</a>
</div>
